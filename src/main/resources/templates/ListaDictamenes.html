<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Lista de DictÃ¡menes</title>
    <link rel="stylesheet" href="/estilosAdministrativos.css" />
    <link rel="stylesheet" href="/ListaDictamenes.css" />
  </head>
  <body class="dark-mode">
    <input type="checkbox" id="theme-toggle" style="display: none" />

    <!-- Label que actÃºa como botÃ³n -->
    <label
      for="theme-toggle"
      style="
        cursor: pointer;
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #005b9f;
        color: white;
        padding: 10px;
        border-radius: 5px;
      "
      >ğŸŒ™</label
    >
    <nav>
      <p class="logo">
        Dr.
        <span
          th:text="${medicoLogueado != null ? medicoLogueado.nombre + ' ' + medicoLogueado.apellido : 'MÃ©dico Independiente'}"
          >MÃ©dico Independiente</span
        >
      </p>
      <div class="nav_bar">
        <a href="/paciente">Pacientes</a>
        <a href="/gestionCitas">GestiÃ³n de Citas</a>
        <a href="/historialCitas">Historial</a>
        <a href="/calendarioMedico">Calendario</a>
        <a href="/dictamen" class="active">DictÃ¡menes</a>
        <a href="/horario">Horarios</a>
        <a href="/PerfilMedicoAjustes">Perfil MÃ©dico</a>
      </div>
    </nav>

    <h1>ğŸ“‹ Lista de DictÃ¡menes</h1>

    <div th:if="${error}" class="error-message" th:text="${error}"></div>
    <div th:if="${mensaje}" class="success-message" th:text="${mensaje}"></div>

    <table>
      <thead>
        <tr>
          <th>ID Cita</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Fecha</th>
          <th>Motivo</th>
          <th style="width: 90px">Estado</th>
          <th style="width: 300px">Contenido</th>
          <th style="width: 150px; text-align: center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="entry : ${citasConDictamen}">
          <td
            th:text="${entry.key.id}"
            style="font-weight: 600; color: #1976d2"
          ></td>
          <!-- Columna Nombre -->
          <td style="font-weight: 500">
            <span
              th:text="${pacienteNombres[entry.key.pacienteId]} ?: 'Sin especificar'"
            ></span>
          </td>
          <!-- Columna Apellido -->
          <td style="font-weight: 500">
            <span
              th:text="${pacienteApellidos[entry.key.pacienteId]} ?: ''"
            ></span>
          </td>
          <td th:text="${entry.key.fecha}"></td>
          <td th:text="${entry.key.motivo}"></td>
          <td>
            <span
              class="badge"
              th:classappend="${entry.key.estado.name()}"
              th:text="${entry.key.estado.descripcion}"
            ></span>
          </td>
          <td
            style="
              max-width: 300px;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            "
          >
            <span
              th:if="${entry.value != null and entry.value.contenido != null}"
              th:text="${entry.value.contenido}"
              style="color: #333; font-size: 14px"
            >
            </span>
            <span
              th:unless="${entry.value != null and entry.value.contenido != null}"
              style="color: #999; font-style: italic"
            >
              Sin dictamen
            </span>
          </td>
          <td style="text-align: center">
            <a
              th:href="@{'/cita/' + ${entry.key.id} + '/dictamen'}"
              style="text-decoration: none"
            >
              <button
                type="button"
                style="
                  background-color: #1976d2;
                  color: white;
                  border: none;
                  padding: 8px 16px;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 14px;
                "
              >
                <span
                  th:if="${entry.value != null and entry.value.contenido != null}"
                  >âœï¸ Editar</span
                >
                <span
                  th:unless="${entry.value != null and entry.value.contenido != null}"
                  >â• Crear</span
                >
              </button>
            </a>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(citasConDictamen)}">
          <td
            colspan="8"
            style="
              text-align: center;
              padding: 30px;
              color: #999;
              font-style: italic;
            "
          >
            ğŸ“ No hay citas registradas
          </td>
        </tr>
      </tbody>
    </table>
    <script src="dark-mode.js"></script>
  </body>
</html>
